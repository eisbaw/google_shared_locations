var log4js = require('log4js');

var Logger = function Logger(log_settings) {
    this.settings = log_settings;
    this.appenders = [];

    var fileAppender = function(path, name, size){
        return { type: 'file', filename : path + name + '.log', category : name, maxLogSize : size };
    }

    for(var i in log_settings.appenders){
        var appender = log_settings.appenders[i];

        this.appenders.push(
            fileAppender(log_settings.path, appender.name, appender.max_log_size)
        );
    }

    log4js.configure({
        'appenders': this.appenders
    });

    for(var i in log_settings.appenders){
        var appender = log_settings.appenders[i];

        var logger = log4js.getLogger(appender.name);
        logger.setLevel(appender.level);
    }

    if(log_settings.is_console) {
        log4js.addAppender(log4js.appenders.console());
    }
}

////////////////////////////////////////////////////////////
///////////////////// Public methods ///////////////////////

Logger.prototype.get = function(name){
    var self = this;

    function myGetLogger(name){
        var ret = log4js.getLogger(self.settings.appenders[0]['name']);
        ret.inspect = function(){
            var s = '';
            for(var i in arguments){
                s += ' ' + require('util').inspect(arguments[i], true, 50);
            }
            ret.warn( s );
        }
        return ret;
    }

    for(var i in self.settings.appenders){
        var appender = self.settings.appenders[i];

        if(name==appender.name){
            return myGetLogger(name);
        }
    }

    if(self.settings.appenders.length>0){
        return myGetLogger(self.settings.appenders[0]['name']);
    } else {
        return undefined;
    }
}

///////////////////// Public methods ///////////////////////
////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////
/////////////////// Module Exports /////////////////////////

module.exports = Logger;

/////////////////// Module Exports /////////////////////////
////////////////////////////////////////////////////////////